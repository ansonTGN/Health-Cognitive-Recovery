<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="app-title">Gu칤a de Configuraci칩n AI Distribuida</title>
    <!-- Incluye estilos LaMuralla para un look consistente -->
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --primary: #00695c; --primary-dark: #004d40; --accent: #d84315; --font-main: 'Manrope', sans-serif; }
        body { font-family: var(--font-main); background-color: #f8fafc; color: #263238; }
        .bg-primary-custom { background-color: var(--primary) !important; }
        .text-primary-custom { color: var(--primary) !important; }
        .lang-pill { background: #f1f3f4; border-radius: 50px; padding: 4px; display: inline-flex; border: 1px solid #cfd8dc; }
        .lang-btn { border: none; background: transparent; padding: 4px 10px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; color: #546e7a; transition: all 0.2s; }
        .lang-btn.active { background: var(--primary); color: white; }
        .step-card { border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        code { background-color: #e8eaf6; padding: 2px 5px; border-radius: 4px; color: #3f51b5; font-weight: 500; }
        pre { background-color: #263238; color: #fff; padding: 1rem; border-radius: 8px; overflow-x: auto; font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body>
    <div class="container py-5">
        <header class="text-center mb-5">
            <div class="bg-primary-custom text-white rounded-3 d-inline-flex align-items-center justify-content-center shadow-sm p-3 mb-3" style="width: 60px; height: 60px;">
                <i class="fa-solid fa-network-wired fa-xl"></i>
            </div>
            <h1 class="fw-bold text-dark" id="t-title">Gu칤a de Configuraci칩n: AI Distribuida</h1>
            <p class="text-muted lead" id="t-subtitle">Ollama (Multi-GPU/M치quina) + Nginx Load Balancer</p>
            
            <div class="mt-4 d-flex justify-content-center">
                <div class="lang-pill">
                    <button class="lang-btn active" id="btn-es" onclick="setLang('es', this)">ES</button>
                    <button class="lang-btn" id="btn-en" onclick="setLang('en', this)">EN</button>
                    <button class="lang-btn" id="btn-ca" onclick="setLang('ca', this)">CA</button>
                </div>
            </div>
        </header>

        <div class="row g-4" id="content-area">
            <!-- Contenido generado por JS -->
        </div>

        <div class="text-center mt-5 pt-4 border-top">
            <p class="text-muted small mb-0" id="t-footer">Una vez completada la configuraci칩n, ejecuta el programa Rust y prueba el endpoint: <code class="text-primary-custom">POST /api/chat</code></p>
        </div>
    </div>
    
    <script>
        const T = {
            es: { 
                title: "Gu칤a de Configuraci칩n: AI Distribuida", 
                subtitle: "Ollama (Multi-GPU/M치quina) + Nginx Load Balancer",
                step1: "Paso 1: Configurar Ollama (M치quinas A y B)",
                p1a: "Ejecuta Ollama en cada m치quina para exponer la GPU local. Aseg칰rate de instalar los mismos modelos (<code class='font-mono'>llama3</code> y <code class='font-mono'>nomic-embed-text</code>).",
                step2: "Paso 2: Configurar Nginx como Load Balancer (M치quina A)",
                p2a: "Nginx actuar치 como un proxy, escuchando en el puerto <code class='font-mono'>8080</code> y distribuyendo las peticiones (chat y embeddings) entre tus dos servidores Ollama (Round Robin).",
                p2b: "Edita el archivo de configuraci칩n de Nginx (ej. <code class='font-mono'>/etc/nginx/conf.d/ollama.conf</code>) con esta configuraci칩n, reemplazando <code class='text-accent'>&lt;IP_MAQUINA_B&gt;</code> por la direcci칩n real:",
                step3: "Paso 3: Configurar el Backend Rust (.env)",
                p3a: "El programa Rust solo debe apuntar a la URL de Nginx, que ya se encarga del balanceo.",
                cmdA: "M치quina A (Local GPU):",
                cmdB: "M치quina B (Remota GPU):",
                envFile: ".env (En el proyecto Rust):",
                nginxRestart: "Reinicia Nginx:",
                footer: "Una vez completada la configuraci칩n, ejecuta el programa Rust y prueba el endpoint: POST /api/chat",
                machine_a_ip: "127.0.0.1 (Local)",
                machine_b_ip: "<IP_MAQUINA_B> (Remota)"
            },
            en: {
                title: "Configuration Guide: Distributed AI",
                subtitle: "Ollama (Multi-GPU/Machine) + Nginx Load Balancer",
                step1: "Step 1: Configure Ollama (Machines A and B)",
                p1a: "Run Ollama on each machine to expose the local GPU. Ensure the same models are installed (<code class='font-mono'>llama3</code> and <code class='font-mono'>nomic-embed-text</code>).",
                step2: "Step 2: Configure Nginx as Load Balancer (Machine A)",
                p2a: "Nginx will act as a proxy, listening on port <code class='font-mono'>8080</code> and distributing requests (chat and embeddings) among your two Ollama servers (Round Robin).",
                p2b: "Edit the Nginx configuration file (e.g., <code class='font-mono'>/etc/nginx/conf.d/ollama.conf</code>) with this config, replacing <code class='text-accent'>&lt;REMOTE_MACHINE_IP&gt;</code> with the actual address:",
                step3: "Step 3: Configure the Rust Backend (.env)",
                p3a: "The Rust program must only point to the Nginx URL, which handles the balancing.",
                cmdA: "Machine A (Local GPU):",
                cmdB: "Machine B (Remote GPU):",
                envFile: ".env (In the Rust Project):",
                nginxRestart: "Restart Nginx:",
                footer: "Once configuration is complete, run the Rust program and test the endpoint: POST /api/chat",
                machine_a_ip: "127.0.0.1 (Local)",
                machine_b_ip: "<REMOTE_MACHINE_IP> (Remote)"
            },
            ca: {
                title: "Guia de Configuraci칩: IA Distribu칦da",
                subtitle: "Ollama (Multi-GPU/M맘uina) + Nginx Load Balancer",
                step1: "Pas 1: Configurar Ollama (M맘uines A i B)",
                p1a: "Executa Ollama a cada m맘uina per exposar la GPU local. Assegura't d'instal췅lar els mateixos models (<code class='font-mono'>llama3</code> i <code class='font-mono'>nomic-embed-text</code>).",
                step2: "Pas 2: Configurar Nginx com a Load Balancer (M맘uina A)",
                p2a: "Nginx actuar com un proxy, escoltant al port <code class='font-mono'>8080</code> i distribuint les peticions (xat i embeddings) entre els teus dos servidors Ollama (Round Robin).",
                p2b: "Edita l'arxiu de configuraci칩 d'Nginx (ex. <code class='font-mono'>/etc/nginx/conf.d/ollama.conf</code>) amb aquesta configuraci칩, reempla칞ant <code class='text-accent'>&lt;IP_MAQUINA_B&gt;</code> per l'adre칞a real:",
                step3: "Pas 3: Configurar el Backend Rust (.env)",
                p3a: "El programa Rust nom칠s ha d'apuntar a la URL d'Nginx, que ja s'encarrega del balanceig.",
                cmdA: "M맘uina A (GPU Local):",
                cmdB: "M맘uina B (GPU Remota):",
                envFile: ".env (Al Projecte Rust):",
                nginxRestart: "Reinicia Nginx:",
                footer: "Una vegada completada la configuraci칩, executa el programa Rust i prova l'endpoint: POST /api/chat",
                machine_a_ip: "127.0.0.1 (Local)",
                machine_b_ip: "<IP_MAQUINA_B> (Remota)"
            }
        };

        const NGINX_CONF = `
http {
    upstream ollama_backends {
        # M맘uina A: Local
        server 127.0.0.1:11434; 
        
        # M맘uina B: Remota (REEMPLAZAR IP)
        server {{ip_b}}:11435; 
    }

    server {
        listen 8080;
        
        location / {
            proxy_buffering off;
            proxy_pass http://ollama_backends;
            proxy_set_header Host $host;
            # ... (otros headers)
        }
    }
}
        `.trim();
        
        const OLLAMA_CMD_A = `
# En M치quina A (La que ejecuta Rust)
export OLLAMA_HOST={{ip_a}}:11434
export OLLAMA_GPU=0
ollama serve
ollama pull llama3
ollama pull nomic-embed-text
        `.trim();
        
        const OLLAMA_CMD_B = `
# En M치quina B (Remota)
export OLLAMA_HOST=0.0.0.0:11435
export OLLAMA_GPU=0
ollama serve
ollama pull llama3
ollama pull nomic-embed-text
        `.trim();
        
        const ENV_FILE_CONTENT = `
AI_BASE_URL=http://127.0.0.1:8080/v1
AI_MODEL=llama3
AI_EMBEDDING_MODEL=nomic-embed-text
AI_EMBEDDING_DIM=768 
AI_API_KEY=dummy_key
        `.trim();

        function renderContent(lang) {
            const t = T[lang];
            
            document.getElementById('t-title').innerText = t.title;
            document.getElementById('t-subtitle').innerText = t.subtitle;
            document.getElementById('t-footer').innerHTML = t.footer;

            const html = `
                <!-- PASO 1 -->
                <div class="col-12">
                    <div class="card step-card p-4">
                        <h4 class="text-primary-custom fw-bold"><i class="fa-solid fa-list-ol me-2"></i> ${t.step1}</h4>
                        <p class="mb-3">${t.p1a}</p>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <h6 class="fw-bold mb-2">${t.cmdA} <code class="font-mono">${t.machine_a_ip}</code></h6>
                                <pre>${OLLAMA_CMD_A.replace('{{ip_a}}', t.machine_a_ip.split(' ')[0])}</pre>
                            </div>
                            <div class="col-md-6">
                                <h6 class="fw-bold mb-2">${t.cmdB} <code class="font-mono text-accent">${t.machine_b_ip}</code></h6>
                                <pre>${OLLAMA_CMD_B}</pre>
                            </div>
                            <p class="text-muted small mt-2">游뚿 <span id="t-firewall">Asegura que el puerto <code class="font-mono">11435</code> est칠 abierto en el Firewall de la M치quina B.</span></p>
                        </div>
                    </div>
                </div>

                <!-- PASO 2 -->
                <div class="col-12">
                    <div class="card step-card p-4">
                        <h4 class="text-primary-custom fw-bold"><i class="fa-solid fa-arrows-split-up-and-merge me-2"></i> ${t.step2}</h4>
                        <p class="mb-3">${t.p2a}</p>
                        <h6 class="fw-bold mb-2">${t.p2b}</h6>
                        <pre>${NGINX_CONF.replace('{{ip_b}}', t.machine_b_ip.split(' ')[0])}</pre>
                        
                        <h6 class="fw-bold mt-3 mb-2">${t.nginxRestart}</h6>
                        <pre>sudo systemctl restart nginx</pre>
                    </div>
                </div>

                <!-- PASO 3 -->
                <div class="col-12">
                    <div class="card step-card p-4">
                        <h4 class="text-primary-custom fw-bold"><i class="fa-solid fa-code me-2"></i> ${t.step3}</h4>
                        <p class="mb-3">${t.p3a}</p>
                        <h6 class="fw-bold mb-2">${t.envFile}</h6>
                        <pre>${ENV_FILE_CONTENT}</pre>
                        
                        <h6 class="fw-bold mt-3 mb-2">3.2. Ejecutar el Backend:</h6>
                        <pre>cargo run --release</pre>
                    </div>
                </div>
            `;
            document.getElementById('content-area').innerHTML = html;
        }

        function setLang(lang, btn) {
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            renderContent(lang);
        }

        window.onload = () => {
            setLang('es', document.getElementById('btn-es'));
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
